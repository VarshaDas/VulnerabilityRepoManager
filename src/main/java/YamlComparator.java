import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.util.Map;

import org.yaml.snakeyaml.Yaml;

import java.util.*;

public class YamlComparator {
        public static void main(String[] args) {
            String directoryPath = "/Users/vd056735/mygitprojects";
            String fileAName = "fileA.yaml";
            String fileBName = "fileB.yaml";

            File fileA = new File(directoryPath, fileAName);
            File fileB = new File(directoryPath, fileBName);

            if (fileA.exists() && fileB.exists() && fileA.isFile() && fileB.isFile()) {
                {
                    List<String> cvesNotInFileA = compareYamlFiles(fileA, fileB);
                    if (cvesNotInFileA.isEmpty()) {
                        System.out.println("All CVEs in File B are present in File A.");
                    } else {
                        System.out.println("CVEs in File B not found in File A:");
                        for (String cve : cvesNotInFileA) {
                            System.out.println(cve);
                        }
                    }
                }
            }
        }

        private static List<String> compareYamlFiles(File fileA, File fileB) {

            List<String> cvesNotInFileA = new ArrayList<>();

            try {
                Yaml yaml = new Yaml();
                List<Map<String, Object>> fileAMap = yaml.load(new FileInputStream(fileA));
                List<Map<String, Object>> fileBMap = yaml.load(new FileInputStream(fileB));
                Map<String, List<String>> CVEMapForB = new HashMap<>();
                Map<String, List<String>> CVEMapForA = new HashMap<>();


                for (Map<String, Object> entry : fileBMap) {
                    String repoName = (String) entry.get("repo");
                    List<String> cveListB = (List<String>) entry.get("cve");
                    CVEMapForB.put(repoName, cveListB);
                }


                for (Map<String, Object> entry : fileAMap) {
                    String repoName = (String) entry.get("repo");
                    List<String> cveListA = (List<String>) entry.get("cve");
                    CVEMapForA.put(repoName, cveListA);
                }

                for (Map.Entry<String, List<String>> entry : CVEMapForB.entrySet()) {
                    String repo = entry.getKey();
                    List<String> cvesB = entry.getValue();

                    if (CVEMapForA.containsKey(repo)) {
                        List<String> cvesA = CVEMapForA.get(repo);
                        for (String cve : cvesB) {
                            if (!cvesA.contains(cve)) {
                                cvesNotInFileA.add(cve);
                            }
                        }
                    } else {
                        cvesNotInFileA.addAll(cvesB);
                    }
                }

            } catch (FileNotFoundException e) {
                e.printStackTrace();
            }
            return cvesNotInFileA;
        }
    }


